function sizeLayerControl(){$(".leaflet-control-layers").css("max-height",$("#map").height()-50)}function clearHighlight(){highlight.clearLayers()}function sidebarClick(a){var b=markerClusters.getLayer(a);map.setView([b.getLatLng().lat,b.getLatLng().lng],17),b.fire("click"),document.body.clientWidth<=767&&($("#sidebar").hide(),map.invalidateSize())}function syncSidebar(){$("#feature-list tbody").empty(),theaters.eachLayer(function(a){map.hasLayer(theaterLayer)&&map.getBounds().contains(a.getLatLng())&&$("#feature-list tbody").append('<tr class="feature-row" id="'+L.stamp(a)+'" lat="'+a.getLatLng().lat+'" lng="'+a.getLatLng().lng+'"><td style="vertical-align: middle;"><img width="16" height="18" src="assets/img/theater.png"></td><td class="feature-name">'+a.feature.properties.NAME+'</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>')}),museums.eachLayer(function(a){map.hasLayer(museumLayer)&&map.getBounds().contains(a.getLatLng())&&$("#feature-list tbody").append('<tr class="feature-row" id="'+L.stamp(a)+'" lat="'+a.getLatLng().lat+'" lng="'+a.getLatLng().lng+'"><td style="vertical-align: middle;"><img width="16" height="18" src="assets/img/museum.png"></td><td class="feature-name">'+a.feature.properties.NAME+'</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>')}),featureList=new List("features",{valueNames:["feature-name"]}),featureList.sort("feature-name",{order:"asc"})}function updateAttribution(a){$.each(map._layers,function(a,b){b.getAttribution&&$("#attribution").html(b.getAttribution())})}var map,featureList,boroughSearch=[],theaterSearch=[],museumSearch=[];$(window).resize(function(){sizeLayerControl()}),$(document).on("click",".feature-row",function(a){$(document).off("mouseout",".feature-row",clearHighlight),sidebarClick(parseInt($(this).attr("id"),10))}),$(document).on("mouseover",".feature-row",function(a){highlight.clearLayers().addLayer(L.circleMarker([$(this).attr("lat"),$(this).attr("lng")],highlightStyle))}),$(document).on("mouseout",".feature-row",clearHighlight),$("#about-btn").click(function(){return $("#aboutModal").modal("show"),$(".navbar-collapse.in").collapse("hide"),!1}),$("#full-extent-btn").click(function(){return map.fitBounds(boroughs.getBounds()),$(".navbar-collapse.in").collapse("hide"),!1}),$("#legend-btn").click(function(){return $("#legendModal").modal("show"),$(".navbar-collapse.in").collapse("hide"),!1}),$("#login-btn").click(function(){return $("#loginModal").modal("show"),$(".navbar-collapse.in").collapse("hide"),!1}),$("#list-btn").click(function(){return $("#sidebar").toggle(),map.invalidateSize(),!1}),$("#nav-btn").click(function(){return $(".navbar-collapse").collapse("toggle"),!1}),$("#sidebar-toggle-btn").click(function(){return $("#sidebar").toggle(),map.invalidateSize(),!1}),$("#sidebar-hide-btn").click(function(){$("#sidebar").hide(),map.invalidateSize()});var mapquestOSM=L.tileLayer("http://{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png",{maxZoom:19,subdomains:["otile1","otile2","otile3","otile4"],attribution:'Tiles courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png">. Map data (c) <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> contributors, CC-BY-SA.'}),mapquestOAM=L.tileLayer("http://{s}.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.jpg",{maxZoom:18,subdomains:["oatile1","oatile2","oatile3","oatile4"],attribution:'Tiles courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a>. Portions Courtesy NASA/JPL-Caltech and U.S. Depart. of Agriculture, Farm Service Agency'}),mapquestHYB=L.layerGroup([L.tileLayer("http://{s}.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.jpg",{maxZoom:18,subdomains:["oatile1","oatile2","oatile3","oatile4"]}),L.tileLayer("http://{s}.mqcdn.com/tiles/1.0.0/hyb/{z}/{x}/{y}.png",{maxZoom:19,subdomains:["oatile1","oatile2","oatile3","oatile4"],attribution:'Labels courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png">. Map data (c) <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> contributors, CC-BY-SA. Portions Courtesy NASA/JPL-Caltech and U.S. Depart. of Agriculture, Farm Service Agency'})]),highlight=L.geoJson(null),highlightStyle={stroke:!1,fillColor:"#00FFFF",fillOpacity:.7,radius:10},boroughs=L.geoJson(null,{style:function(a){return{color:"black",fill:!1,opacity:1,clickable:!1}},onEachFeature:function(a,b){boroughSearch.push({name:b.feature.properties.BoroName,source:"Boroughs",id:L.stamp(b),bounds:b.getBounds()})}});$.getJSON("data/boroughs.geojson",function(a){boroughs.addData(a)});var subwayLines=L.geoJson(null,{style:function(a){return"1"===a.properties.route_id||"2"===a.properties.route_id||"3"===a.properties.route_id?{color:"#ff3135",weight:3,opacity:1}:"4"===a.properties.route_id||"5"===a.properties.route_id||"6"===a.properties.route_id?{color:"#009b2e",weight:3,opacity:1}:"7"===a.properties.route_id?{color:"#ce06cb",weight:3,opacity:1}:"A"===a.properties.route_id||"C"===a.properties.route_id||"E"===a.properties.route_id||"SI"===a.properties.route_id||"H"===a.properties.route_id?{color:"#fd9a00",weight:3,opacity:1}:"Air"===a.properties.route_id?{color:"#ffff00",weight:3,opacity:1}:"B"===a.properties.route_id||"D"===a.properties.route_id||"F"===a.properties.route_id||"M"===a.properties.route_id?{color:"#ffff00",weight:3,opacity:1}:"G"===a.properties.route_id?{color:"#9ace00",weight:3,opacity:1}:"FS"===a.properties.route_id||"GS"===a.properties.route_id?{color:"#6e6e6e",weight:3,opacity:1}:"J"===a.properties.route_id||"Z"===a.properties.route_id?{color:"#976900",weight:3,opacity:1}:"L"===a.properties.route_id?{color:"#969696",weight:3,opacity:1}:"N"===a.properties.route_id||"Q"===a.properties.route_id||"R"===a.properties.route_id?{color:"#ffff00",weight:3,opacity:1}:void 0},onEachFeature:function(a,b){if(a.properties){var c="<table class='table table-striped table-bordered table-condensed'><tr><th>Division</th><td>"+a.properties.Division+"</td></tr><tr><th>Line</th><td>"+a.properties.Line+"</td></tr><table>";b.on({click:function(b){$("#feature-title").html(a.properties.Line),$("#feature-info").html(c),$("#featureModal").modal("show")}})}b.on({mouseover:function(a){var b=a.target;b.setStyle({weight:3,color:"#00FFFF",opacity:1}),L.Browser.ie||L.Browser.opera||b.bringToFront()},mouseout:function(a){subwayLines.resetStyle(a.target)}})}});$.getJSON("data/subways.geojson",function(a){subwayLines.addData(a)});var markerClusters=new L.MarkerClusterGroup({spiderfyOnMaxZoom:!0,showCoverageOnHover:!1,zoomToBoundsOnClick:!0,disableClusteringAtZoom:16}),theaterLayer=L.geoJson(null),theaters=L.geoJson(null,{pointToLayer:function(a,b){return L.marker(b,{icon:L.icon({iconUrl:"assets/img/theater.png",iconSize:[24,28],iconAnchor:[12,28],popupAnchor:[0,-25]}),title:a.properties.NAME,riseOnHover:!0})},onEachFeature:function(a,b){if(a.properties){var c="<table class='table table-striped table-bordered table-condensed'><tr><th>Name</th><td>"+a.properties.NAME+"</td></tr><tr><th>Phone</th><td>"+a.properties.TEL+"</td></tr><tr><th>Address</th><td>"+a.properties.ADDRESS1+"</td></tr><tr><th>Website</th><td><a class='url-break' href='"+a.properties.URL+"' target='_blank'>"+a.properties.URL+"</a></td></tr><table>";b.on({click:function(b){$("#feature-title").html(a.properties.NAME),$("#feature-info").html(c),$("#featureModal").modal("show"),highlight.clearLayers().addLayer(L.circleMarker([a.geometry.coordinates[1],a.geometry.coordinates[0]],highlightStyle))}}),$("#feature-list tbody").append('<tr class="feature-row" id="'+L.stamp(b)+'" lat="'+b.getLatLng().lat+'" lng="'+b.getLatLng().lng+'"><td style="vertical-align: middle;"><img width="16" height="18" src="assets/img/theater.png"></td><td class="feature-name">'+b.feature.properties.NAME+'</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>'),theaterSearch.push({name:b.feature.properties.NAME,address:b.feature.properties.ADDRESS1,source:"Theaters",id:L.stamp(b),lat:b.feature.geometry.coordinates[1],lng:b.feature.geometry.coordinates[0]})}}});$.getJSON("data/DOITT_THEATER_01_13SEPT2010.geojson",function(a){theaters.addData(a),map.addLayer(theaterLayer)});var museumLayer=L.geoJson(null),museums=L.geoJson(null,{pointToLayer:function(a,b){return L.marker(b,{icon:L.icon({iconUrl:"assets/img/museum.png",iconSize:[24,28],iconAnchor:[12,28],popupAnchor:[0,-25]}),title:a.properties.NAME,riseOnHover:!0})},onEachFeature:function(a,b){if(a.properties){var c="<table class='table table-striped table-bordered table-condensed'><tr><th>Name</th><td>"+a.properties.NAME+"</td></tr><tr><th>Phone</th><td>"+a.properties.TEL+"</td></tr><tr><th>Address</th><td>"+a.properties.ADRESS1+"</td></tr><tr><th>Website</th><td><a class='url-break' href='"+a.properties.URL+"' target='_blank'>"+a.properties.URL+"</a></td></tr><table>";b.on({click:function(b){$("#feature-title").html(a.properties.NAME),$("#feature-info").html(c),$("#featureModal").modal("show"),highlight.clearLayers().addLayer(L.circleMarker([a.geometry.coordinates[1],a.geometry.coordinates[0]],highlightStyle))}}),$("#feature-list tbody").append('<tr class="feature-row" id="'+L.stamp(b)+'" lat="'+b.getLatLng().lat+'" lng="'+b.getLatLng().lng+'"><td style="vertical-align: middle;"><img width="16" height="18" src="assets/img/museum.png"></td><td class="feature-name">'+b.feature.properties.NAME+'</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>'),museumSearch.push({name:b.feature.properties.NAME,address:b.feature.properties.ADRESS1,source:"Museums",id:L.stamp(b),lat:b.feature.geometry.coordinates[1],lng:b.feature.geometry.coordinates[0]})}}});$.getJSON("data/DOITT_MUSEUM_01_13SEPT2010.geojson",function(a){museums.addData(a)}),map=L.map("map",{zoom:10,center:[40.702222,-73.979378],layers:[mapquestOSM,boroughs,markerClusters,highlight],zoomControl:!1,attributionControl:!1}),map.on("overlayadd",function(a){a.layer===theaterLayer&&(markerClusters.addLayer(theaters),syncSidebar()),a.layer===museumLayer&&(markerClusters.addLayer(museums),syncSidebar())}),map.on("overlayremove",function(a){a.layer===theaterLayer&&(markerClusters.removeLayer(theaters),syncSidebar()),a.layer===museumLayer&&(markerClusters.removeLayer(museums),syncSidebar())}),map.on("moveend",function(a){syncSidebar()}),map.on("click",function(a){highlight.clearLayers()}),map.on("layeradd",updateAttribution),map.on("layerremove",updateAttribution);var attributionControl=L.control({position:"bottomright"});attributionControl.onAdd=function(a){var b=L.DomUtil.create("div","leaflet-control-attribution");return b.innerHTML="<span class='hidden-xs'>Developed by <a href='http://bryanmcbride.com'>bryanmcbride.com</a> | </span><a href='#' onclick='$(\"#attributionModal\").modal(\"show\"); return false;'>Attribution</a>",b},map.addControl(attributionControl);var zoomControl=L.control.zoom({position:"bottomright"}).addTo(map),locateControl=L.control.locate({position:"bottomright",drawCircle:!0,follow:!0,setView:!0,keepCurrentZoomLevel:!0,markerStyle:{weight:1,opacity:.8,fillOpacity:.8},circleStyle:{weight:1,clickable:!1},icon:"icon-direction",metric:!1,strings:{title:"My location",popup:"You are within {distance} {unit} from this point",outsideMapBoundsMsg:"You seem located outside the boundaries of the map"},locateOptions:{maxZoom:18,watch:!0,enableHighAccuracy:!0,maximumAge:1e4,timeout:1e4}}).addTo(map);if(document.body.clientWidth<=767)var isCollapsed=!0;else var isCollapsed=!1;var baseLayers={"Street Map":mapquestOSM,"Aerial Imagery":mapquestOAM,"Imagery with Streets":mapquestHYB},groupedOverlays={"Points of Interest":{"<img src='assets/img/theater.png' width='24' height='28'>&nbsp;Theaters":theaterLayer,"<img src='assets/img/museum.png' width='24' height='28'>&nbsp;Museums":museumLayer},Reference:{Boroughs:boroughs,"Subway Lines":subwayLines}},layerControl=L.control.groupedLayers(baseLayers,groupedOverlays,{collapsed:isCollapsed}).addTo(map);$("#searchbox").click(function(){$(this).select()}),$("#searchbox").keypress(function(a){13==a.which&&a.preventDefault()}),$("#featureModal").on("hidden.bs.modal",function(a){$(document).on("mouseout",".feature-row",clearHighlight)}),$(document).one("ajaxStop",function(){$("#loading").hide(),sizeLayerControl(),map.fitBounds(boroughs.getBounds()),featureList=new List("features",{valueNames:["feature-name"]}),featureList.sort("feature-name",{order:"asc"});var a=new Bloodhound({name:"Boroughs",datumTokenizer:function(a){return Bloodhound.tokenizers.whitespace(a.name)},queryTokenizer:Bloodhound.tokenizers.whitespace,local:boroughSearch,limit:10}),b=new Bloodhound({name:"Theaters",datumTokenizer:function(a){return Bloodhound.tokenizers.whitespace(a.name)},queryTokenizer:Bloodhound.tokenizers.whitespace,local:theaterSearch,limit:10}),c=new Bloodhound({name:"Museums",datumTokenizer:function(a){return Bloodhound.tokenizers.whitespace(a.name)},queryTokenizer:Bloodhound.tokenizers.whitespace,local:museumSearch,limit:10}),d=new Bloodhound({name:"GeoNames",datumTokenizer:function(a){return Bloodhound.tokenizers.whitespace(a.name)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:"http://api.geonames.org/searchJSON?username=bootleaf&featureClass=P&maxRows=5&countryCode=US&name_startsWith=%QUERY",filter:function(a){return $.map(a.geonames,function(a){return{name:a.name+", "+a.adminCode1,lat:a.lat,lng:a.lng,source:"GeoNames"}})},ajax:{beforeSend:function(a,b){b.url+="&east="+map.getBounds().getEast()+"&west="+map.getBounds().getWest()+"&north="+map.getBounds().getNorth()+"&south="+map.getBounds().getSouth(),$("#searchicon").removeClass("fa-search").addClass("fa-refresh fa-spin")},complete:function(a,b){$("#searchicon").removeClass("fa-refresh fa-spin").addClass("fa-search")}}},limit:10});a.initialize(),b.initialize(),c.initialize(),d.initialize(),$("#searchbox").typeahead({minLength:3,highlight:!0,hint:!1},{name:"Boroughs",displayKey:"name",source:a.ttAdapter(),templates:{header:"<h4 class='typeahead-header'>Boroughs</h4>"}},{name:"Theaters",displayKey:"name",source:b.ttAdapter(),templates:{header:"<h4 class='typeahead-header'><img src='assets/img/theater.png' width='24' height='28'>&nbsp;Theaters</h4>",suggestion:Handlebars.compile(["{{name}}<br>&nbsp;<small>{{address}}</small>"].join(""))}},{name:"Museums",displayKey:"name",source:c.ttAdapter(),templates:{header:"<h4 class='typeahead-header'><img src='assets/img/museum.png' width='24' height='28'>&nbsp;Museums</h4>",suggestion:Handlebars.compile(["{{name}}<br>&nbsp;<small>{{address}}</small>"].join(""))}},{name:"GeoNames",displayKey:"name",source:d.ttAdapter(),templates:{header:"<h4 class='typeahead-header'><img src='assets/img/globe.png' width='25' height='25'>&nbsp;GeoNames</h4>"}}).on("typeahead:selected",function(a,b){"Boroughs"===b.source&&map.fitBounds(b.bounds),"Theaters"===b.source&&(map.hasLayer(theaterLayer)||map.addLayer(theaterLayer),map.setView([b.lat,b.lng],17),map._layers[b.id]&&map._layers[b.id].fire("click")),"Museums"===b.source&&(map.hasLayer(museumLayer)||map.addLayer(museumLayer),map.setView([b.lat,b.lng],17),map._layers[b.id]&&map._layers[b.id].fire("click")),"GeoNames"===b.source&&map.setView([b.lat,b.lng],14),$(".navbar-collapse").height()>50&&$(".navbar-collapse").collapse("hide")}).on("typeahead:opened",function(){$(".navbar-collapse.in").css("max-height",$(document).height()-$(".navbar-header").height()),$(".navbar-collapse.in").css("height",$(document).height()-$(".navbar-header").height())}).on("typeahead:closed",function(){$(".navbar-collapse.in").css("max-height",""),$(".navbar-collapse.in").css("height","")}),$(".twitter-typeahead").css("position","static"),$(".twitter-typeahead").css("display","block")});var container=$(".leaflet-control-layers")[0];L.Browser.touch?L.DomEvent.disableClickPropagation(container):L.DomEvent.disableClickPropagation(container).disableScrollPropagation(container);